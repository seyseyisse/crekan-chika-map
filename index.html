<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>地価公示マップ（広島県）</title>

  <!-- Leaflet CSS -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  />

  <style>
    body { margin: 0; }
    #map { width: 100%; height: 100vh; }

    table {
      border-collapse: collapse;
      font-size: 12px;
    }
    th, td {
      border: 1px solid #999;
      padding: 4px 6px;
    }
    th {
      background: #f0f0f0;
      white-space: nowrap;
    }
  </style>
</head>
<body>

<div id="map"></div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
  // ① 地図初期化（広島市 中区中心）
  const map = L.map('map').setView([34.3955, 132.4555], 14);

  // ② 背景地図：鮮明・標準（王道）
  L.tileLayer(
    'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
    {
      attribution: '© OpenStreetMap contributors'
    }
  ).addTo(map);

  // ③ GeoJSON 読み込み
  fetch('L01-25_34.geojson')
    .then(res => res.json())
    .then(data => {

      L.geoJSON(data, {
        pointToLayer: (feature, latlng) => {
          return L.circleMarker(latlng, {
            radius: 8,
            color: '#0078ff',
            weight: 1,
            fillOpacity: 0.8
          });
        },

        onEachFeature: (feature, layer) => {
          const p = feature.properties;

          // ---- 年次データ ----
          const price2025 = p.L01_104; // 最新
          const price2024 = p.L01_103; // 前年

          const diff = (price2025 && price2024)
            ? price2025 - price2024
            : null;

          const diffRate = (price2025 && price2024)
            ? ((diff / price2024) * 100).toFixed(1)
            : null;

          // ---- ポップアップ ----
          const popupHtml = `
            <table>
              <tr><th>地点名</th><td>${p.L01_024}</td></tr>
              <tr><th>所在地</th><td>${p.L01_025}</td></tr>

              <tr>
                <th>地価（2025）</th>
                <td><b>${price2025?.toLocaleString() ?? '-'}</b> 円/㎡</td>
              </tr>

              <tr><th>用途</th><td>${p.L01_028}</td></tr>
              <tr><th>用途地域</th><td>${p.L01_051}</td></tr>
              <tr><th>建ぺい率</th><td>${p.L01_057}%</td></tr>
              <tr><th>容積率</th><td>${p.L01_058}%</td></tr>
              <tr><th>最寄駅</th><td>${p.L01_048}</td></tr>

              <tr><th colspan="2">地価推移（前年比）</th></tr>
              <tr>
                <th>2024 → 2025</th>
                <td>
                  ${diff !== null
                    ? `${diff > 0 ? '＋' : ''}${diff.toLocaleString()} 円（${diff > 0 ? '＋' : ''}${diffRate}％）`
                    : '-'}
                </td>
              </tr>
            </table>
          `;

          layer.bindPopup(popupHtml);
        }
      }).addTo(map);

    })
    .catch(err => {
      console.error('GeoJSON 読み込み失敗', err);
      alert('GeoJSONの読み込みに失敗しました');
    });
</script>

</body>
</html>
